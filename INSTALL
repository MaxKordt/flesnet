FLESnet
=======

BUILD DEPENDENCIES
------------------

sudo aptitude install gcc make cmake valgrind \
 doxygen libnuma-dev librdmacm-dev libibverbs-dev git

Fairroot external packages
 See http://fairroot.gsi.de/?q=node/8
 After installing set SIMPATH to point to this installation

If your machine doesn't feature InfiniBand you need to install SoftiWARP
 cd contrib
 ./install-softiwarp

If you like to have controls access to CBMnet via the controls API
you need the cbmnetcntlserver library found in the CBMroot repository.
(Note: the make target is 'cbmnetcntlserver')

For compiling flesnet with Controls API support set the environment Variables
CNETCNTLSERVER_PATH to the cbmnetcntlserver library and include location, e.g.

'export CNETCNTLSERVER_PATH=/opt/cbmroot/build/lib:/opt/cbmroot/fles/ctrl'

Building flesnet
----------------

mkdir build
cd build && cmake ..
make

Building the FLIB kernel module
-------------------------------

The kernel module is not part of the CMake flow, so it is necessary to
build it manually.

sudo apt-get install linux-headers-$(uname -r)

cd misc/kernel
make

Preparing the operating system
------------------------------

Set the kernel boot options 'pcie_aspm=off 'acpi=ht noapic'

for Debian with Grub modify /etc/defaults/grub
GRUB_CMDLINE_LINUX_DEFAULT="pcie_aspm=off acpi=ht noapic"

Xilinx Software for using a FLIB
================================

Xilinx Tools
------------

Install at least the Xilinx Lab Tools (newest version)

./xsetup
Don’t install cable drivers when asked!

Xilinx Cable drivers
--------------------

sudo aptitude install libusb-dev fxload
go to Xilinx install directory (e.g., /opt/xilinx/14.7/LabTools)
. settings64.sh 
cd LabTools/bin/lin64/install_script/install_drivers/linux_drivers/pcusb
sudo ./setup_pcusb 1 (has to say “Using udev…“)
sudo sed -i -e 's/TEMPNODE/tempnode/' -e 's/SYSFS/ATTRS/g' -e 's/BUS/SUBSYSTEMS/' /etc/udev/rules.d/xusbdfwu.rules
sudo /etc/init.d/udev restart

If cable drivers are working correctly and a cable is plugged in 
lsusb should give you something like

...
Bus 001 Device 008: ID 03fd:0008 Xilinx, Inc. 
...

Note the 03fd:0008.
