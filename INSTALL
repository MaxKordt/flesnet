FLESnet
=======

BUILD DEPENDENCIES
------------------

sudo aptitude install gcc make cmake valgrind \
 doxygen libnuma-dev librdmacm-dev libibverbs-dev git

Fairroot external packages
 See http://fairroot.gsi.de/?q=node/8
 After installing set SIMPATH to point to this installation

If your machine doesn't feature InfiniBand you need to install SoftiWARP
 cd contrib
 ./install-softiwarp

If you like to have controls access to CBMnet via the controls API
you need the cbmnetcntlserver library found in the CBMroot repository.
(Note: the make target is 'cbmnetcntlserver')

Building flesnet
----------------
For compiling flesnet with Controls API support set the environment Variables
CNETCNTLSERVER_PATH to the cbmnetcntlserver library and include location, e.g.
'export CNETCNTLSERVER_PATH=/opt/cbmroot/build/lib:/opt/cbmroot/fles/ctrl'

git submodule init
git submodule update
mkdir build
cd build && cmake ..
make

Building the PDA (for the FLIB driver)
-------------------------------

The PDA is the external library which is used to implement the FLIB driver lib-
rary. The installation procedure is scripted, just run:

cd contrib
./pda_inst.sh

BIG FAT WARNING: THIS SCRIPT IS _ONLY_ FOR DEBIAN.

Note, user can only access the FLIB if they are member of the group "sudo". Al-
so, the PDA udev rules might not be active after installing. The sure way to 
make it active is to reboot the computer. Other procedures as ...

udevadm control --reload-rules

... might also work, but this is for sure system dependent. The script always
installs the currently needed version. Please rerun the script if you encounter
compilation errors.

Preparing the operating system
------------------------------

Set the kernel boot options 'pcie_aspm=off 'acpi=ht noapic'

for Debian with Grub modify /etc/defaults/grub
GRUB_CMDLINE_LINUX_DEFAULT="pcie_aspm=off acpi=ht noapic"

Xilinx Software for using a FLIB
================================

Xilinx Tools
------------

Install at least the Xilinx Lab Tools (newest version)

./xsetup
Don’t install cable drivers when asked!

Xilinx Cable drivers
--------------------

sudo aptitude install libusb-dev fxload
go to Xilinx install directory (e.g., /opt/xilinx/14.7/LabTools)
. settings64.sh 
cd LabTools/bin/lin64/install_script/install_drivers/linux_drivers/pcusb
sudo ./setup_pcusb 1 (has to say “Using udev…“)
sudo sed -i -e 's/TEMPNODE/tempnode/' -e 's/SYSFS/ATTRS/g' -e 's/BUS/SUBSYSTEMS/' /etc/udev/rules.d/xusbdfwu.rules
sudo /etc/init.d/udev restart

If cable drivers are working correctly and a cable is plugged in 
lsusb should give you something like

...
Bus 001 Device 008: ID 03fd:0008 Xilinx, Inc. 
...

Note the 03fd:0008.
